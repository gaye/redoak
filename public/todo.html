<!doctype html>
<html lang='en'>
  <head>
    <meta charset='UTF-8'/>
    <title>TODO app</title>
  </head>
  <body>
    <template name='app'>
      <div class='app'>
        <link rel='stylesheet' href='todo.css'></link>
        <h1>Todos</h1>
        <form oak-onsubmit='newTodo'>
          <input name='input' type='text'
                 placeholder='What needs to be done?' autocomplete='off'>
          </input>
        </form>
        <use mixins='todo'>{ "id": 1, "text": "remember the milk"}</use>
      </div>
    </template>

    <template name='todo'>
      <div class='todo'>
        <input id='todo-item-{{id}}' type='checkbox' autocomplete='off'></input>
        <label for='todo-item-{{id}}'>{{text}}</label>
      </div>
    </template>

    <use mixins='app preserve'>{ "id": "app" }</use>

    <script>
      BaseWidget.event('app').listen({
        newTodo: function(e) {
          var input = e.target.elements.input;
          var value = input.value.replace(/^\s+|\s+$/, '');
          if (value) {
            var widget = new BaseWidget(['todo', 'preserve']);
            var view = {
              text: value,
              id: this.children_.length + 1
            };
            this.addChild(widget);
            widget.render(this.getElement(), null, view);
          }
          input.value = '';
          e.preventDefault();
          return false;
        }
      });

      BaseWidget.event('todo').listen({
        rendered: function() {
          var parentEl = this.parent_.getElement();
          var form = parentEl.querySelector('form');
          parentEl.insertBefore(this.getElement(), form.nextSibling);
        }
      });
    </script>
  </body>
</html>
